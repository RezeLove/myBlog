---
title: æ‰‹å†™é˜²æŠ–ä¸èŠ‚æµ
order: 14
category:
  - é¢è¯•
  - JS
---

## å‚è€ƒé“¾æ¥

[JS æ‰‹å†™é¢˜-é˜²æŠ–-èŠ‚æµ](https://juejin.cn/post/7032905194736189477#heading-14)
[ä¸€æ¯èŒ¶çš„æ—¶é—´ ğŸµï¼Œå¸¦ä½ å½»åº•å­¦ä¼šæ‰‹å†™é˜²æŠ–èŠ‚æµ](https://juejin.cn/post/7016502001911463950?searchId=202312291442165C3D171345B548DFCF86#heading-6)

## é˜²æŠ–ä¸èŠ‚æµçš„ä½œç”¨

1. é˜²æŠ–

é˜²æŠ–çš„ä½œç”¨æ˜¯åœ¨äº‹ä»¶è¿ç»­å¯†é›†è§¦å‘æ—¶ï¼Œå‡½æ•°çš„è§¦å‘ä¼šè¢«ä¸€ç›´æ¨è¿Ÿï¼Œå½¢è±¡çš„ä¾‹å­æ˜¯ï¼šlol ä¸­çš„å›åŸï¼Œå¦‚æœåœ¨å›åŸçš„è¿‡ç¨‹ä¸­å†æ¬¡ bï¼ˆè§¦å‘æ–°çš„äº‹ä»¶ï¼‰ï¼Œå½“å‰çš„è¯»ç§’ä¼šè¢«æ‰“æ–­ï¼Œè¿›å…¥æ–°çš„è¯»ç§’ï¼Œç›´åˆ°è¯»ç§’ç»“æŸæ‰å›åŸï¼ˆæ‰§è¡Œäº‹ä»¶å‡½æ•°ï¼‰

åº”ç”¨åœºæ™¯ï¼šè¾“å…¥æ¡†é¢‘ç¹è¾“å…¥å†…å®¹ï¼Œæœç´¢æˆ–è€…æäº¤ä¿¡æ¯ï¼›ç›‘å¬æµè§ˆå™¨æ»šåŠ¨äº‹ä»¶ç­‰

2. èŠ‚æµ

èŠ‚æµæ˜¯æŒ‡å½“äº‹ä»¶é¢‘å‘è§¦å‘æ—¶ï¼Œä¼šæŒ‰ç…§ä¸€å®šçš„é¢‘ç‡æ¥æ‰§è¡Œå‡½æ•°ï¼Œå½¢è±¡çš„ä¾‹å­æ˜¯ï¼šlol ä¸­çš„ cdï¼Œå½“é‡Šæ”¾äº†ä¸€æ¬¡æŠ€èƒ½ï¼ˆè§¦å‘äº‹ä»¶ï¼‰,ä¼šè¿›å…¥ cdï¼Œæ­¤åå†ç‚¹å‡»è¿™ä¸ªæŠ€èƒ½ï¼ˆå†æ¬¡è§¦å‘äº‹ä»¶ï¼‰ï¼Œéƒ½æ— æ³•é‡Šæ”¾ï¼ˆæ‰§è¡Œå‡½æ•°ï¼‰ï¼Œåªèƒ½ cd å†·å´å¥½

## æ‰‹å†™é˜²æŠ–

é¦–å…ˆæ¨¡æ‹Ÿä¸€ä¸ªä¾‹å­

```js
let addBtn = document.getElementById("add");
function addOne() {
  console.log("å¢åŠ ä¸€ä¸ª");
  console.log(this);
}
addBtn.addEventListener("click", addOne);
```

1. æœ€åŸºç¡€çš„é˜²æŠ–

æ€è·¯ï¼šæ¯æ¬¡äº‹ä»¶è§¦å‘æ—¶ï¼Œå¦‚æœæœ‰ä¹‹å‰è®¾å®šçš„å®šæ—¶å™¨ï¼Œå°±æ¸…é™¤ï¼Œé‡æ–°è®¾å®šä¸€ä¸ªå®šæ—¶å™¨ï¼Œæ‰§è¡Œå›è°ƒå‡½æ•°

```js
function debounce(fun, delay) {
  let timer;
  return function event() {
    clearTimeout(timer);
    timer = setTimeout(() => {
      fun();
    }, delay);
  };
}
```

å­˜åœ¨é—®é¢˜ï¼š

- æ— æ³•è·å–å…¥å‚
- å›è°ƒå‡½æ•°çš„ this æŒ‡å‘ windowï¼Œå¸Œæœ›èƒ½æŒ‡å‘ event äº‹ä»¶ï¼Œä»è€Œå¯ä»¥è·å–`ClientXç­‰å±æ€§`
- å¸Œæœ›èƒ½å¤Ÿç¬¬ä¸€æ¬¡ç«‹å³æ‰§è¡Œ

2. ä¿®æ”¹ç‰ˆé˜²æŠ–

```js
function debounce(fun, delay, immediate = false) {
  let timer;
  // è®°å½•æ˜¯å¦ç«‹å³æ‰§è¡Œ, é»˜è®¤ä¸ºfalse

  let isImmediateInvoke = false;
  return function event() {
    if (timer) {
      clearTimeout(timer);
    }
    // è·å–å…¥å‚
    let args = arguments;

    // å½“æ˜¯ç¬¬ä¸€æ¬¡è§¦å‘ï¼Œå¹¶ä¸”éœ€è¦è§¦å‘ç¬¬ä¸€æ¬¡äº‹ä»¶
    if (!isImmediateInvoke && immediate) {
      fun.apply(this, args);
      // å°†isImmediateInvokeè®¾ç½®ä¸ºtrueï¼Œè¿™æ ·ä¸ä¼šå½±å“åˆ°åé¢é¢‘ç¹è§¦å‘çš„å‡½æ•°è°ƒç”¨
      isImmediateInvoke = true;
    }
    timer = setTimeout(() => {
      // å›è°ƒå‡½æ•°çš„thisæŒ‡å‘windowæ˜¯å› ä¸ºåœ¨winowä¸­è¢«æ‰§è¡Œï¼Œè¿™é‡Œå¸Œæœ›thisèƒ½å¤ŸæŒ‡å‘event
      fun.apply(this, args);

      // æˆåŠŸæ‰§è¡Œå›è°ƒå‡½æ•°åï¼Œå†å°†isImmediateInvokeè®¾ä¸ºfalseï¼Œä¿è¯ä¸‹ä¸€è½®çš„æ—¶å€™ç«‹å³æ‰§è¡Œ
      isImmediateInvoke = false;
    }, delay);
  };
}
```

## æ‰‹å†™èŠ‚æµ

1. åŸºç¡€

è¿™æ ·çš„åšæ³•æœ‰ä¸ªç¼ºé™·ï¼šåˆå§‹çš„ lastTime ä¸º 0ï¼Œæ‰€ä»¥æ— è®ºå¦‚ä½•ç¬¬ä¸€æ¬¡éƒ½ä¼šæ‰§è¡Œ

```js
function throttle(fn, interval) {
  // è®°å½•ä¸Šä¸€æ¬¡æ‰§è¡Œæ—¶é—´
  let lastTime = 0;
  return function event() {
    const nowTime = new Date();
    const leftTime = nowTime - lastTime;
    if (leftTime > interval) {
      fn.apply(this, arguments);
      // å°†ä¸Šä¸€æ¬¡å‡½æ•°æ‰§è¡Œçš„æ—¶é—´è®¾ç½®ä¸ºnowTimeï¼Œè¿™æ ·ä¸‹æ¬¡æ‰èƒ½é‡æ–°è¿›å…¥cd
      lastTime = nowTime;
    }
  };
}
```

2. æ§åˆ¶ç¬¬ä¸€æ¬¡ç«‹å³æ‰§è¡Œ

```js
// è¿™é‡Œçš„pendingè¡¨ç¤ºæ˜¯å¦è¦å»¶è¿Ÿæ‰§è¡Œ
function throttle(fn, interval, pending = true) {
  // è®°å½•ä¸Šä¸€æ¬¡æ‰§è¡Œæ—¶é—´
  let lastTime = 0;
  // falseè¡¨ç¤ºä¸éœ€è¦å»¶è¿Ÿ
  let ispending = true;
  return function event() {
    const nowTime = new Date();
    if (ispending && pending) {
      // å°†lastTimeè®¾ç½®ä¸ºnowTimeï¼Œè¿™æ ·å°±ä¸ä¼šå¯¼è‡´ç¬¬ä¸€æ¬¡æ—¶remainTimeå¤§äºinterval
      lastTime = nowTime;
      // å°†ispendingè®¾ç½®ä¸ºfalseï¼Œè¿™æ ·å°±æ‰ä¸ä¼šå¯¹åç»­çš„lastTimeäº§ç”Ÿå½±å“ã€‚
      ispending = false;
    }
    const leftTime = nowTime - lastTime;
    if (leftTime > interval) {
      fn.apply(this, arguments);
      // å°†ä¸Šä¸€æ¬¡å‡½æ•°æ‰§è¡Œçš„æ—¶é—´è®¾ç½®ä¸ºnowTimeï¼Œè¿™æ ·ä¸‹æ¬¡æ‰èƒ½é‡æ–°è¿›å…¥cd
      lastTime = nowTime;
      ispending = true;
    }
  };
}
```
